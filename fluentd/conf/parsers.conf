# Advanced Log Parsers for MCP Services
# Specialized parsers for different log formats and sources

# JSON Parser for structured logs
<match mcp.**>
  @type parser
  key_name message
  reserve_data true
  remove_key_name_field false
  <parse>
    @type json
    time_key timestamp
    time_format %Y-%m-%dT%H:%M:%S.%LZ
    keep_time_key true
  </parse>
</match>

# Parser for HTTP access logs
<filter mcp.http>
  @type parser
  key_name message
  reserve_data true
  <parse>
    @type apache2
    time_format %d/%b/%Y:%H:%M:%S %z
    keep_time_key true
  </parse>
</filter>

# Parser for SQL query logs
<filter mcp.sql>
  @type parser
  key_name message
  reserve_data true
  <parse>
    @type grok
    pattern %{GREEDYDATA:query} %{NUMBER:duration_ms}ms
    keep_time_key true
  </parse>
</filter>

# Parser for LLM operation logs
<filter mcp.llm>
  @type parser
  key_name message
  reserve_data true
  <parse>
    @type grok
    pattern %{WORD:operation} %{GREEDYDATA:model} %{NUMBER:prompt_tokens} tokens %{NUMBER:completion_tokens} tokens %{NUMBER:duration_ms}ms
    keep_time_key true
  </parse>
</filter>

# Parser for agent collaboration logs
<filter mcp.collaboration>
  @type parser
  key_name message
  reserve_data true
  <parse>
    @type grok
    pattern %{WORD:collaboration_type} %{GREEDYDATA:participants} %{NUMBER:duration_ms}ms %{WORD:result}
    keep_time_key true
  </parse>
</filter>

# Parser for Git operation logs
<filter mcp.git>
  @type parser
  key_name message
  reserve_data true
  <parse>
    @type grok
    pattern %{WORD:git_operation} %{GREEDYDATA:repository} %{WORD:branch} %{NUMBER:duration_ms}ms %{WORD:status}
    keep_time_key true
  </parse>
</filter>

# Parser for workflow execution logs
<filter mcp.workflow>
  @type parser
  key_name message
  reserve_data true
  <parse>
    @type grok
    pattern %{WORD:workflow_type} %{GREEDYDATA:workflow_id} %{NUMBER:steps} steps %{NUMBER:duration_ms}ms %{WORD:status}
    keep_time_key true
  </parse>
</filter>

# Parser for security event logs
<filter mcp.security>
  @type parser
  key_name message
  reserve_data true
  <parse>
    @type grok
    pattern %{WORD:security_event} %{GREEDYDATA:target} %{WORD:severity} %{GREEDYDATA:details}
    keep_time_key true
  </parse>
</filter>

# Parser for performance metrics logs
<filter mcp.performance>
  @type parser
  key_name message
  reserve_data true
  <parse>
    @type grok
    pattern %{WORD:metric_name} %{NUMBER:value} %{GREEDYDATA:unit} %{GREEDYDATA:context}
    keep_time_key true
  </parse>
</filter>

# Parser for audit trail logs
<filter mcp.audit>
  @type parser
  key_name message
  reserve_data true
  <parse>
    @type grok
    pattern %{WORD:audit_action} %{GREEDYDATA:resource} %{WORD:user} %{WORD:result} %{GREEDYDATA:details}
    keep_time_key true
  </parse>
</filter>

# Parser for error logs with stack traces
<filter mcp.error>
  @type parser
  key_name message
  reserve_data true
  <parse>
    @type multiline
    format_firstline /^.*Error:/
    format1 /^(?<error_type>.+?): (?<error_message>.+)$/
    format2 /at (?<stack_frame>.+)$/
    keep_time_key true
  </parse>
</filter>

# Parser for system logs
<filter mcp.system>
  @type parser
  key_name message
  reserve_data true
  <parse>
    @type syslog
    time_format %b %d %H:%M:%S
    keep_time_key true
  </parse>
</filter>

# Parser for container logs
<filter mcp.container>
  @type parser
  key_name message
  reserve_data true
  <parse>
    @type json
    time_key timestamp
    time_format %Y-%m-%dT%H:%M:%S.%LZ
    keep_time_key true
  </parse>
</filter>

# Parser for Kubernetes logs
<filter kubernetes.**>
  @type parser
  key_name message
  reserve_data true
  <parse>
    @type json
    time_key timestamp
    time_format %Y-%m-%dT%H:%M:%S.%LZ
    keep_time_key true
  </parse>
</filter>

# Parser for Windows Event Logs
<filter mcp.windows>
  @type parser
  key_name message
  reserve_data true
  <parse>
    @type json
    time_key TimeCreated
    time_format %Y-%m-%dT%H:%M:%S.%LZ
    keep_time_key true
  </parse>
</filter>